!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=10)}([function(e,t){var i=function(e,t){this.id=e,this.name="player"+e.substring(0,6),this.socket=t};i.prototype={getId:function(){return this.id},getName:function(){return this.name},setName:function(e){this.name=e},getSocket:function(){return this.socket},getDTO:function(){return{id:this.getId(),name:this.getName()}}},e.exports=i},function(e){e.exports={gameConfiguration:[{nbplayer:3,gap:5,given:[3,3,3,3,3,3,2],filtering:!1},{nbplayer:4,gap:5,given:[3,3,3,3,3],filtering:!1},{nbplayer:5,gap:4,given:[3,3,3,3],filtering:!1},{nbplayer:6,gap:3,given:[3,3,3,1],filtering:!1},{nbplayer:7,gap:3,given:[3,3,2],filtering:!0},{nbplayer:8,gap:3,given:[3,3,1],filtering:!0}]}},function(e,t){var i=function(e,t,i,n,r,a,s){this.scoringGame=[],this.playedCards=[],this.givenCards=i,this.action=n,this.gap=r,this.ppyou=a,this.currentPlayer=s,e.forEach(function(e){this.scoringGame.push(e)},this),t.forEach(function(e,t){this.playedCards.push({id:t,card:e})},this)};i.prototype={},e.exports=i},function(e,t){var i=function(e,t,i,n){this.id=e,this.rank=t,this.suit=i,this.value=n||0,this.selected=!1};i.prototype={},e.exports=i},function(e,t,i){var n=i(3),r=i(2),a=i(1),s=[1,2,3,4,5,6,7,8,9,10],o=["S","H","C","D"],d=function(e,t){this.id=e,this.players=t,this.deck=[],this.gameConfig,this.playerReady=0,this.ScoringGame=new Map,this.playedCards=[],this.givenCards=new Map,this.gapCards=new Map,this.winningCard=new Map,this.startingPlayPlayer,this.currentTurnPlayer,this.firstCard=null,this.ppyou};d.prototype={start:function(){this.startingPlayPlayer=0,this.currentTurnPlayer=0,this.initiateGameScoring(),this.loadGameConfiguratiton(this.players.length),this.initiateDeck(),this.randomizeDeck(),this.distributeGiven(this.players.length),this.startGame()},loadGameConfiguratiton:function(e){logger.debug("loadGameConfiguratiton"),this.gameConfig=a.gameConfiguration.find(function(t){return t.nbplayer===e})},startGame:function(){logger.debug("startGame");let e=this;this.players.forEach(function(t){t.socket.addListener("ready to play",function(){logger.debug("EVENT : ready to play"),e.playerReady++,e.playerReady==e.players.length&&(e.refreshData.call(e,"GAP"),e.playerReady=0)}),t.socket.addListener("gap",function(t){logger.debug("EVENT : gap"),e.isValidGap.call(e,this.id,t)?(e.playerReady++,e.gapCards.set(this.id,t),e.playerReady==e.players.length&&(e.dispatchGap.call(e),e.refreshData.call(e,"NONE"),setTimeout(function(){e.clearHand.call(e),e.refreshData.call(e,"PLAY")},3e3),e.playerReady=0)):logger.error("Gap Error")}),t.socket.addListener("play card",function(t){if(logger.debug("EVENT : play card"),e.isValidPlayedCard.call(e,this.id,t)){var i=e.givenCards.get(this.id).filter(function(e){return e.id===t})[0];null===e.firstCard&&(e.firstCard=i),e.playedCards[e.playedCards.length-1].set(this.id,i),e.givenCards.set(this.id,e.givenCards.get(this.id).filter(function(e){return e.id!=i.id})),e.refreshData.call(e,"NONE"),e.playedCards.length===e.gameConfig.given.reduce(function(e,t){return e+t},0)&&e.playedCards[e.playedCards.length-1].size===e.players.length?setTimeout(function(){var t=e.defineWinner.call(e,e.playedCards[e.playedCards.length-1]);e.playedCards[e.playedCards.length-1].forEach(function(i){e.winningCard.get(t).push(i)}),e.players.forEach(function(t){e.updateScoringGame.call(e,t.id,e.winningCard.get(t.id).map(function(e){return e.value}).reduce(function(e,t){return e+t},0))}),e.startingPlayPlayer=(e.startingPlayPlayer+1)%e.players.length,e.playedCards=[],e.playedCards.push(new Map),e.firstCard=null,e.players.forEach(function(t){e.winningCard.set(t.id,[])}),e.initiateDeck.call(e),e.randomizeDeck.call(e),e.distributeGiven.call(e,e.players.length),e.refreshData.call(e,"GAP")},3e3):e.playedCards[e.playedCards.length-1].size===e.players.length?setTimeout(function(){var t=e.defineWinner.call(e,e.playedCards[e.playedCards.length-1]);e.currentTurnPlayer=e.players.findIndex(function(e){return e.id===t}),e.playedCards[e.playedCards.length-1].forEach(function(i){e.winningCard.get(t).push(i)}),e.playedCards.push(new Map),e.firstCard=null,e.refreshData.call(e,"PLAY")},3e3):(e.currentTurnPlayer=(e.currentTurnPlayer+1)%e.players.length,e.refreshData.call(e,"PLAY"))}else e.refreshData.call(e,"PLAY")})})},defineWinner:function(e){logger.debug("defineWinner");let t=this;var i=null,n=t.firstCard;return e.forEach(function(e,n){e===t.firstCard&&(i=n)}),e.forEach(function(e,t){e.suit===n.suit&&e.rank>n.rank&&(i=t,n=e)}),i},isValidPlayedCard:function(e,t){logger.debug("isValidPlayedCard");let i=this;var n;n=i.players[i.currentTurnPlayer].id===e;var r=i.givenCards.get(e).filter(function(e){return e.id===t});return n=(n=n&&1===r.length)&&(null===i.firstCard||i.firstCard.suit===r[0].suit||!i.givenCards.get(e).some(function(e){return e.suit===i.firstCard.suit}))},clearHand:function(){logger.debug("clearHand");let e=this;e.players.forEach(function(t){e.givenCards.set(t.id,e.givenCards.get(t.id).map(function(e){return e.selected=!1,e}))})},dispatchGap:function(){logger.debug("dispatchGap");let e=this;e.players.forEach(function(t,i){var n=e.givenCards.get(t.id).filter(function(i){return e.gapCards.get(t.id).indexOf(i.id)>=0}).map(function(e){return e.selected=!0,e}),r=e.players[(i+1)%e.players.length],a=e.givenCards.get(r.id).concat(n);a.sort(function(e,t){return e.id-t.id}),e.givenCards.set(r.id,a);var s=e.givenCards.get(t.id).filter(function(i){return e.gapCards.get(t.id).indexOf(i.id)<0});e.givenCards.set(t.id,s)})},isValidGap:function(e,t){logger.debug("isValidGap");let i=this;return t.every(function(t){return i.givenCards.get(e).map(function(e){return e.id}).indexOf(t)>=0})},refreshData:function(e){logger.debug("refreshData");let t=this;t.players.forEach(function(i,n){i.socket.emit("refresh data",new r(t.ScoringGame,t.playedCards[t.playedCards.length-1],t.givenCards.get(i.getId()),"PLAY"===e&&n===t.currentTurnPlayer||"PLAY"!==e?e:"NONE",t.gameConfig.gap,t.ppyou,t.currentTurnPlayer))})},initiateGameScoring:function(){logger.debug("initiateGameScoring");for(let e of this.players)this.ScoringGame.set(e.id,{id:e.id,name:e.name,score:0}),this.winningCard.set(e.id,[]);this.playedCards.push(new Map)},updateScoringGame:function(e,t){logger.debug("updateScoringGame");var i=this.ScoringGame.get(e);this.ScoringGame.set(e,{id:i.id,name:i.name,score:i.score+t})},initiateDeck:function(){logger.debug("initiateDeck"),this.ppyou=o[Math.floor(Math.random()*o.length)];var e=0;for(let i of o)for(let r of s)if(!this.gameConfig.filtering||"1"!==r){var t=new n(e++,r,i,7===r&&i===this.ppyou?40:0);this.deck.push(t)}for(var i=1;i<21;i++){t=new n(e++,i,"B",i);this.deck.push(t)}},randomizeDeck:function(){logger.debug("randomizeDeck"),this.deck.sort(function(){return.5-Math.random()})},distributeGiven:function(){logger.debug("distributeGiven");for(let t of this.gameConfig.given)for(let i of this.players){var e=this.givenCards.get(i.id);void 0===e&&(e=[]),(e=e.concat(this.deck.slice(0,t))).sort(function(e,t){return e.id-t.id}),this.givenCards.set(i.id,e),this.deck=this.deck.slice(t,this.deck.length)}}},e.exports=d},function(e,t,i){var n=i(4),r=function(e){this.id=e,this.players=[],this.status="WAITING"};r.prototype={getId:function(){return this.id},getPlayers:function(){return this.players},addPlayer:function(e){this.playerById(e.getId())||this.players.push(e)},removePlayer:function(e){var t=this.playerById(e);t&&this.players.splice(this.players.indexOf(t),1)},playerById:function(e){for(var t=0;t<this.players.length;t++)if(this.players[t].getId()==e)return this.players[t];return!1},getStatus:function(){return this.status},start:function(){this.status="INPROGRESS",this.gameEngine=new n(this.id,this.players),this.gameEngine.start()}},e.exports=r},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("express")},function(e,t,i){(function(e){var t=i(9),n=t(),r=i(8).Server(n),a=i(7)(r,{serveClient:!1}),s=i(6),o=s.config;logger=new s.Logger({level:"debug",transports:[new s.transports.Console({timestamp:function(){return Date.now()},formatter:function(e){return new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour24:!0}).format(e.timestamp())+" "+o.colorize(e.level,e.level.toUpperCase())+" "+(e.message?e.message:"")+(e.meta&&Object.keys(e.meta).length?"\n\t"+JSON.stringify(e.meta):"")}})]}),a.set("transports",["polling","websocket"]);var d=i(5),l=i(0),g=[],u=[],c=[];n.use(t.static("client"));var f=process.env.PORT||process.env.OPENSHIFT_NODEJS_PORT||8080;process.env.IP||process.env.OPENSHIFT_NODEJS_IP;function h(e){logger.debug("onRename"),p(this.id).setName(e)}r.listen(f,null,function(){logger.debug("Listening on "+this._connectionKey)}),n.get("/",function(t,i){i.sendFile(e+"/client/index.html")}),logger.debug("Starting Server"),a.on("connection",function(e){logger.debug("New player has connected: "+e.id);var t=new l(e.id,e);u.push(t),e.on("disconnect",v),e.on("rename",h),e.on("get gamelist",b),e.on("host game",G),e.on("join game",S),e.on("get playerlist",y),e.on("leave game",m),e.on("start game",O)}),logger.debug("Server Initialized");var p=function(e){for(var t=0;t<u.length;t++)if(u[t].id==e)return u[t];return!1};function y(e){logger.debug("onPlayerList");var t=C(e.id);t?this.emit("list players",t.getPlayers().map(function(e){return e.getDTO()})):logger.debug("Game not found: "+e.id)}function m(e){logger.debug("onLeaveGame");var t=C(e.id);t?(this.id===e.id?(this.to(e.id).broadcast.emit("end game",t.id),g.splice(g.indexOf(t),1),this.broadcast.emit("list games",g.filter(P).slice(0,4).map(function(e){return{id:e.getId()}}))):(t.removePlayer(this.id),this.to(e.id).broadcast.emit("list players",t.getPlayers().map(function(e){return e.getDTO()}))),this.leave(e.id)):logger.debug("Game not found: "+this.id)}function v(){logger.debug("onClientDisconnect"),logger.debug("Player disconnected: "+this.id);var e=c[this.id],t=C(e);t?(c[this.id]=null,e===this.id||"INPROGRESS"===t.getStatus()?(this.to(e).broadcast.emit("end game",t.id),g.splice(g.indexOf(t),1),this.broadcast.emit("list games",g.filter(P).slice(0,4).map(function(e){return{id:e.getId()}}))):"WAITING"===t.getStatus()&&(t.removePlayer(this.id),this.to(e).broadcast.emit("list players",t.getPlayers().map(function(e){return e.getDTO()})))):logger.debug("Game not found: "+e)}var C=function(e){for(var t=0;t<g.length;t++)if(g[t].id==e)return g[t];return!1};function b(){logger.debug("onGameList"),this.emit("list games",g.filter(P).slice(0,4).map(function(e){return{id:e.getId()}}))}function P(e){return"WAITING"==e.status}function G(e){if(logger.debug("onHostGame"),function(e){for(var t=0;t<g.length;t++)if(g[t].id===e)return!0;return!1}(this.id))logger.debug("game already host : "+this.id);else{logger.debug("host new game : "+this.id);var t=new d(this.id),i=p(this.id);i.setName(e.name),t.addPlayer(i),c[this.id]=this.id,g.push(t),this.join(this.id),this.emit("game joined",{id:t.getId()}),this.broadcast.emit("list games",g.map(function(e){return{id:e.getId()}}))}}function S(e){logger.debug("onJoinGame : "+e.id);var t=C(e.id);if(t){this.join(e.id);var i=p(this.id);i.setName(e.name),t.addPlayer(i),c[this.id]=e.id,this.to(e.id).broadcast.emit("list players",t.getPlayers().map(function(e){return e.getDTO()})),this.emit("game joined",{id:t.getId()})}else logger.debug("Game not found: "+e.id)}function O(){logger.debug("onStartGame");var e=c[this.id];C(e).start(),this.to(e).broadcast.emit("start game")}}).call(this,"/")}]);